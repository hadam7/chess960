@implements IDisposable
@inject NavigationManager NavigationManager

<div class="md:fixed md:inset-y-4 md:left-4 md:w-20 lg:w-64 glass-panel z-50 flex flex-col transition-all duration-300">
    
    <!-- Logo Area -->
    <div class="p-6 flex justify-center lg:justify-start items-center">
        <a class="flex items-center gap-3 group" href="">
            <span class="hidden lg:block font-display font-bold text-2xl text-white tracking-tight group-hover:text-theme-accent transition-colors">Chess<span class="text-theme-accent">960</span></span>
        </a>
    </div>

    <!-- Mobile Toggle -->
    <div class="md:hidden absolute top-4 right-4">
            <button class="p-2 rounded-lg hover:bg-white/10 transition-colors" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
            <span class="bi bi-list text-2xl text-white"></span>
        </button>
    </div>

    <!-- Navigation Links -->
    <div id="mobile-menu" class="hidden md:flex flex-col flex-1 px-2 lg:px-4 py-4 space-y-2 overflow-y-auto">
        <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="" Match="NavLinkMatch.All">
            <span class="bi bi-house-door text-xl lg:mr-3 group-hover:scale-110 transition-transform" style="color: #4ade80;"></span> 
            <span class="hidden lg:block">Home</span>
        </NavLink>

        <div class="hidden lg:block mt-6 mb-2 px-4 text-xs font-bold text-white/30 uppercase tracking-widest">Play</div>
        <div class="lg:hidden w-full h-px bg-white/10 my-2"></div>
        
        <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="play-bot">
            <span class="bi bi-robot text-xl lg:mr-3 group-hover:scale-110 transition-transform" style="color: #fb923c;"></span>
            <span class="hidden lg:block">Play vs Bot</span>
        </NavLink>
        <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="play-online">
            <span class="bi bi-people text-xl lg:mr-3 group-hover:scale-110 transition-transform" style="color: #c084fc;"></span>
            <span class="hidden lg:block">Multiplayer</span>
        </NavLink>
        <!-- Friends Link -->
        <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="friends">
            <span class="bi bi-person-heart text-xl lg:mr-3 group-hover:scale-110 transition-transform" style="color: #f87171;"></span>
            <span class="hidden lg:block">Friends</span>
        </NavLink>

        <div class="hidden lg:block mt-6 mb-2 px-4 text-xs font-bold text-white/30 uppercase tracking-widest">Account</div>
        <div class="lg:hidden w-full h-px bg-white/10 my-2"></div>

        <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="settings">
            <span class="bi bi-gear text-xl lg:mr-3 group-hover:scale-110 transition-transform text-gray-400"></span>
            <span class="hidden lg:block">Settings</span>
        </NavLink>

        <AuthorizeView>
            <Authorized>
                <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="profile">
                    <span class="bi bi-person-circle text-xl lg:mr-3 group-hover:scale-110 transition-transform" style="color: #60a5fa;"></span>
                    <span class="hidden lg:block">Profile</span>
                </NavLink>
                <form action="Account/Logout" method="post" class="w-full mt-2">
                    <AntiforgeryToken />
                    <input type="hidden" name="ReturnUrl" value="@currentUrl" />
                    <button type="submit" class="w-full text-left flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-red-500/20 hover:text-red-400 group">
                        <span class="bi bi-box-arrow-right text-xl lg:mr-3 group-hover:text-red-400 transition-colors"></span>
                        <span class="hidden lg:block">Logout</span>
                    </button>
                </form>
            </Authorized>
            <NotAuthorized>
                <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="login">
                    <span class="bi bi-box-arrow-in-right text-xl lg:mr-3 group-hover:scale-110 transition-transform text-theme-accent"></span>
                    <span class="hidden lg:block">Login</span>
                </NavLink>
                <NavLink class="flex items-center justify-center lg:justify-start px-3 py-3 rounded-full text-theme-muted font-medium transition-all duration-200 hover:bg-white/10 hover:text-white group" href="register">
                    <span class="bi bi-person-plus text-xl lg:mr-3 group-hover:scale-110 transition-transform text-theme-accent"></span>
                    <span class="hidden lg:block">Register</span>
                </NavLink>
            </NotAuthorized>
        </AuthorizeView>
    </div>
    
    <!-- User Mini Profile (Bottom) -->
    <AuthorizeView>
        <Authorized>
            <div class="p-4 border-t border-white/10 bg-black/10">
                <div class="flex items-center justify-center lg:justify-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-theme-accent flex items-center justify-center font-bold text-black shadow-lg">
                        @context.User.Identity?.Name?.Substring(0, 1).ToUpper()
                    </div>
                    <div class="hidden lg:block overflow-hidden">
                        <div class="font-bold truncate text-sm text-white">@context.User.Identity?.Name</div>
                        <div class="text-xs text-theme-accent flex items-center gap-1">
                            <span class="w-2 h-2 rounded-full bg-theme-accent animate-pulse"></span> Online
                        </div>
                    </div>
                </div>
            </div>
        </Authorized>
    </AuthorizeView>
</div>

@code {
    private string? currentUrl;

    protected override void OnInitialized()
    {
        currentUrl = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        NavigationManager.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        currentUrl = NavigationManager.ToBaseRelativePath(e.Location);
        StateHasChanged();
    }

    public void Dispose()
    {
        NavigationManager.LocationChanged -= OnLocationChanged;
    }
}

